"use strict";angular.module("angular.boleto",["ui.mask"]).filter("boleto",["$filter",function(){return function(e){if("undefined"!=typeof e&&null!==e){var e=e.replace(/[^0-9-]/g,"");if(""===e)return"";var r=e.slice(0,5)+".";return r=r+e.slice(5,10)+" ",r=r+e.slice(10,15)+".",r=r+e.slice(15,21)+" ",r=r+e.slice(21,26)+".",r=r+e.slice(26,32)+" ",r=r+e.slice(32,33)+" ",r+=e.slice(33,47)}return""}}]).filter("utc",["$filter",function(e){return function(r,t){var a,n;return(angular.isNumber(r)||angular.isString(r))&&(a=new Date(r)),n=angular.isDate(a)?new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()):r,"undefined"!=typeof t&&t?e("date")(n,t):n}}]).directive("inputBoleto",["$filter",function(e){return{restrict:"E",replace:!0,require:"?ngModel",scope:{form:"=",name:"@",validarValor:"=",validarVencimento:"="},template:'<input type="text" ui-mask="?99999.99999 99999.999999 99999.999999 9 99999999999999" />',link:function(r,t,a){r.$watch(a.ngModel,function(e){n(e)});var n=function(e){var t;return i(),"undefined"!=typeof e&&0!=e.length?(t=e.replace(/[^0-9]/g,""),t.length<47?(r.form[r.name].$setValidity("tamanhoErrado",!1),!1):0===parseInt(t)||0===t.length?(r.form[r.name].$setValidity("zerado",!1),!1):47==t.length&&u(t)?!0:void 0):void 0},i=function(){r.form[r.name].$setValidity("tamanhoErrado",!0),r.form[r.name].$setValidity("zerado",!0),r.form[r.name].$setValidity("verificadorErrado",!0),r.form[r.name].$setValidity("bloco1Errado",!0),r.form[r.name].$setValidity("bloco2Errado",!0),r.form[r.name].$setValidity("bloco3Errado",!0),r.form[r.name].$setValidity("valorErrado",!0),r.form[r.name].$setValidity("vencimentoErrado",!0)},o=function(e){for(var r,t=0,a=2,n=e.length-1;n>=0;)r=e.substr(n,1)*a,r>=10&&(r=1+(r-10)),t+=r,a=2==a?1:2,n-=1;var i=10-t%10;return 10==i&&(i=0),i},l=function(t){var a=function(r,t){return t=angular.copy(t),"number"==typeof t&&(t=e("utc")(t)),t.setTime(t.getTime()+24*parseInt(r)*60*60*1e3)},n=function(e,r){return Math.ceil((r-e)/864e5)},i=e("utc")("1997-10-07T00:00:00Z"),o=e("utc")(r.validarVencimento),l=n(i,o);if(l>9999){console.log("Data dentro do limite normalizado no comunicado FEBRABAN de nÂ° 082/2012 de 14/06/2012.",r.validarVencimento);var u=e("utc")(a(9e3,i));i=angular.copy(u)}return a(t,i)},u=function(t){var a=t.substr(0,9),n=t.substr(9,1),i=o(a);if(0===parseInt(a)||n!=i)return r.form[r.name].$setValidity("bloco1Errado",!1),!1;var u=t.substr(10,10),d=t.substr(20,1),s=o(u);if(0===parseInt(u)||d!=s)return r.form[r.name].$setValidity("bloco2Errado",!1),!1;var f=t.substr(21,10),c=t.substr(31,1),m=o(f);if(0===parseInt(f)||c!=m)return r.form[r.name].$setValidity("bloco3Errado",!1),!1;if("undefined"!=typeof r.validarVencimento&&""!==r.validarVencimento){var v=t.substr(33,4);if(1*v>=1e3){var y=l(v);if(y=e("utc")(y,"yyyy-MM-dd"),r.validarVencimento!==y)return r.form[r.name].$setValidity("vencimentoErrado",!1),!1}}if("undefined"!=typeof r.validarValor){var g=t.substr(37,10);if(g=parseFloat(g.substr(0,8)+"."+g.substr(g.length-2)),g!==parseFloat(r.validarValor))return r.form[r.name].$setValidity("valorErrado",!1),!1}return!0}}}}]);